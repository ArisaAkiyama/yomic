<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:MyMangaApp.ViewModels"
        mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="380"
        x:Class="MyMangaApp.Views.UpdateDialog"
        Width="400" Height="380"
        WindowStartupLocation="CenterOwner"
        SystemDecorations="None"
        Background="Transparent"
        TransparencyLevelHint="AcrylicBlur"
        x:DataType="vm:UpdateDialogViewModel">

    <Border Background="#CC1E1E2E" CornerRadius="24" BorderBrush="#313244" BorderThickness="1" Padding="0">
        <Grid RowDefinitions="Auto, *, Auto">
            
            <!-- Top Close Button -->
            <Button Grid.Row="0" Command="{Binding CloseCommand}"
                    HorizontalAlignment="Right" Margin="15"
                    Content="&#xE711;" FontFamily="Segoe Fluent Icons" 
                    Background="Transparent" Foreground="#6C7086" FontSize="14"
                    BorderThickness="0"/>

            <!-- Main Content -->
            <StackPanel Grid.Row="1" Spacing="20" VerticalAlignment="Center" Margin="30,0">
                
                <!-- Status Icon Ring -->
                <Border Width="80" Height="80" CornerRadius="40" Background="#252535"
                        HorizontalAlignment="Center">
                    <TextBlock Text="{Binding StatusIcon}" FontFamily="Segoe Fluent Icons" FontSize="32" 
                               Foreground="{Binding StatusColor}"
                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>

                <!-- Status Text -->
                <StackPanel Spacing="5">
                    <TextBlock Text="{Binding StatusText}" FontSize="20" FontWeight="Bold" 
                               Foreground="White" HorizontalAlignment="Center" TextAlignment="Center"/>
                    
                    <TextBlock Text="{Binding LatestVersion}" 
                               IsVisible="{Binding IsUpdateAvailable}"
                               Foreground="{Binding StatusColor}" FontSize="14" FontWeight="SemiBold" 
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Loading Bar (Indeterminate) -->
                <ProgressBar IsIndeterminate="True" Width="150" Height="4" 
                             Foreground="{Binding StatusColor}" Background="#313244"
                             IsVisible="{Binding IsLoading}" HorizontalAlignment="Center"/>

                <!-- Download Progress Bar -->
                <StackPanel Spacing="5" IsVisible="{Binding IsDownloading}">
                    <ProgressBar Value="{Binding DownloadProgress}" Maximum="100" 
                                 Width="200" Height="6" 
                                 Foreground="{Binding StatusColor}" Background="#313244"
                                 HorizontalAlignment="Center" ShowProgressText="False"/>
                    <TextBlock Text="{Binding DownloadProgress, StringFormat='{} {0:0}%'}" 
                               Foreground="#A6ADC8" FontSize="12" HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Release Notes (Subtle) -->
                 <ScrollViewer VerticalScrollBarVisibility="Hidden" Height="60" IsVisible="{Binding !IsLoading}">
                    <TextBlock Text="{Binding ReleaseNotes}" Foreground="#A6ADC8" 
                               TextWrapping="Wrap" FontSize="13" LineHeight="20"
                               HorizontalAlignment="Center" TextAlignment="Center" Opacity="0.8"/>
                </ScrollViewer>
            </StackPanel>

            <!-- Bottom Actions -->
            <StackPanel Grid.Row="2" Margin="30">
                
                <!-- Update Available Action -->
                <Button Command="{Binding DownloadCommand}" Content="Install Now"
                        IsVisible="{Binding IsUpdateAvailable}"
                        Background="{Binding StatusColor}" Foreground="White" 
                        CornerRadius="12" Padding="20,12" FontWeight="Bold" FontSize="15"
                        HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
                     <Button.Styles>
                        <Style Selector="Button:pointerover /template/ ContentPresenter">
                            <Setter Property="Opacity" Value="0.9"/>
                        </Style>
                    </Button.Styles>
                </Button>

                <!-- No Update Action -->
                 <Button Command="{Binding CloseCommand}" Content="Close"
                        IsVisible="{Binding !IsUpdateAvailable}"
                        Background="#252535" Foreground="White" 
                        CornerRadius="12" Padding="20,12" FontWeight="SemiBold" FontSize="14"
                        HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
                      <Button.Styles>
                        <Style Selector="Button:pointerover /template/ ContentPresenter">
                            <Setter Property="Background" Value="#313244"/>
                        </Style>
                    </Button.Styles>
                </Button>

            </StackPanel>
        </Grid>
    </Border>
</Window>
